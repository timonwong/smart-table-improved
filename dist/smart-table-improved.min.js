/*
 * angular-smart-table-improved v0.5.0
 * https://github.com/timonwong/smart-table-improved
 *
 * (c) 2016 Timon Wong
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):t(e.angular)}(this,function(e){"use strict";function t(t){function a(e){var a=t.$stiRowIdField,n=t.$stiSelected[e[a]];return n&&n.checked}function n(e,a){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=n.broadcast,r=void 0===i?!1:i,l=t.$stiRowIdField;if(t.$stiSelected[e[l]]={checked:a,row:e},a?t.$stiNumSelected++:t.$stiNumSelected--,r){var o={row:e,checked:a};t.$broadcast(c.rowSelected,o)}}function i(a){var n=t.$stiRowIdField,i=t.$stiSelected,r={},l=0;e.forEach(a,function(e){var t=e[n],a=i[t];a&&(r[t]=a,a.checked&&l++)}),t.$stiNumSelected=l,t.$stiSelected=r}var r=this;t.$stiSelected={},t.$stiNumSelected=0,r.isSelected=a,r.select=n,r.updateSelectedStatus=i}function a(t){function a(a,n,i,r){function l(){var e=c.tableState().pagination,t={currentPage:Math.floor(e.start/e.number)+1,numberOfPages:e.numberOfPages,totalItemCount:e.totalItemCount};u(a,{$pagination:t})}var c=r[0],o=r[1];if(a.$stiRowIdField=e.isDefined(i.rowIdField)?i.rowIdField:"$$hashKey","all"===i.trackSelectedMode?a.$watchCollection(i.stSafeSrc,o.updateSelectedStatus.bind(o)):"displayed"===i.trackSelectedMode&&a.$watchCollection(i.stTable,o.updateSelectedStatus.bind(o)),i.defaultSort){var s=e.isDefined(i.defaultSortReverse)?a.$parent.$eval(i.defaultSortReverse):!1;c.sortBy(i.defaultSort,s)}var u=void 0;i.onPagination&&(u=t(i.onPagination),a.$watch(function(){return c.tableState().pagination},l,!0))}return{restrict:"A",require:["stTable","stiTable"],scope:!0,controller:"StiTableController",controllerAs:"stiTableCtrl",link:a}}function n(t){function a(a,i,r,l){function c(){var e=l.tableState().pagination,t=a.currentPage;a.currentPage=Math.floor(e.start/e.number)+1,a.totalItemCount=e.totalItemCount,a.numPages=e.numberOfPages,a.pages=n(a.currentPage,e.totalItemCount,a.itemsPerPage,o),a.range.lower=e.start+1,a.range.upper=e.start+e.number+1,t!==a.currentPage&&a.onPageChange({newPage:a.currentPage})}a.itemsPerPage=a.itemsPerPage?a.itemsPerPage:t.itemsPerPage,a.maxSize=a.maxSize?a.maxSize:t.maxSize,a.autoHide=e.isDefined(a.autoHide)?a.autoHide:!1,a.directionLinks=e.isDefined(r.directionLinks)?a.$parent.$eval(r.directionLinks):!0,a.boundaryLinks=e.isDefined(r.boundaryLinks)?a.$parent.$eval(r.boundaryLinks):!1,a.paginationClass=r.paginationClass||"";var o=Math.max(a.maxSize,5);a.pages=[],a.pagination={last:1,current:1},a.range={lower:1,upper:1},a.$watch(function(){return l.tableState().pagination},c,!0),a.$watch("itemsPerPage",function(e,t){e!==t&&a.selectPage(1)}),a.$watch("maxSize",c),a.selectPage=function(e){e>0&&e<=a.numPages&&l.slice((e-1)*a.itemsPerPage,a.itemsPerPage)},l.tableState().pagination.number||l.slice(0,a.itemsPerPage),a.tracker=function(e,t){return e+"_"+t}}function n(e,t,a,n){var r=[],l=Math.ceil(t/a),c=Math.ceil(n/2),o=void 0;o=c>=e?"start":e>l-c?"end":"middle";for(var s=l>n,u=1;l>=u&&n>=u;){var d=i(u,e,n,l),g=2===u&&("middle"===o||"end"===o),m=u===n-1&&("middle"===o||"start"===o);s&&(g||m)?r.push("..."):r.push(d),u++}return r}function i(e,t,a,n){var i=Math.ceil(a/2);return e===a?n:1===e?e:n>a?t>n-i?n-a+e:t>i?t-i+e:e:e}return{restrict:"EA",require:"^stTable",scope:{itemsPerPage:"=?",maxSize:"=?",onPageChange:"&",autoHide:"=?"},templateUrl:function(e,a){return a.templateUrl||t.templateUrl},link:a}}function i(){function e(e,t,a,n){function i(){e.$apply(function(){var a=t.prop("checked");r.select(e.row,a,{broadcast:!0})})}var r=n;t.on("click",i)}return{restrict:"A",require:"^stiTable",scope:{row:"=stiSelect"},link:e}}function r(){function t(t,a,n,i){function r(){t.$apply(function(){var n=a.prop("checked");e.forEach(t.rows,function(e){var t=o.isSelected(e);t!==n&&o.select(e,n)})})}function l(){var e=t.rows,n=e.length,i=e.filter(o.isSelected).length;a.prop("checked",n>0&&n===i)}var o=i[0],s=i[1];a.on("click",r),t.$watch(function(){return s.tableState()},l,!0),t.$watch("rows.length",l),t.$on(c.rowSelected,l)}return{restrict:"A",require:["^stiTable","^stTable"],scope:{rows:"=stiSelectAll"},link:t}}e.module("smart-table-improved.templates",[]),e.module("smart-table-improved",["smart-table","smart-table-improved.templates"]);var l="stiTable",c={rowSelected:l+":rowSelected"};e.module("smart-table-improved").controller("StiTableController",t).directive("stiTable",a),t.$inject=["$scope"],a.$inject=["$parse"],e.module("smart-table-improved").constant("stiPaginationConfig",{itemsPerPage:10,maxSize:10,templateUrl:"sti/template/sti-pagination.html"}).directive("stiPagination",n),n.$inject=["stiPaginationConfig"],e.module("smart-table-improved").directive("stiSelect",i),i.$inject=[],e.module("smart-table-improved").directive("stiSelectAll",r),r.$inject=[],e.module("smart-table-improved.templates").run(["$templateCache",function(e){e.put("sti/template/sti-pagination.html",'<ul class="pagination {{ paginationClass }}" ng-if="pages.length > 1 || !autoHide">\n  <li ng-if="::boundaryLinks" ng-class="{disabled: currentPage === 1}">\n    <a href="" ng-click="selectPage(1)">&laquo;</a>\n  </li>\n  <li ng-if="::directionLinks" ng-class="{disabled: currentPage === 1}">\n    <a href="" ng-click="selectPage(currentPage - 1)">&lsaquo;</a>\n  </li>\n  <li ng-repeat="pageNumber in pages track by tracker(pageNumber, $index)" ng-class="{active: currentPage === pageNumber, disabled: pageNumber === \'...\'}" class="pagenumbers">\n    <a href="" ng-click="selectPage(pageNumber)">{{ pageNumber }}</a>\n  </li>\n  <li ng-if="::directionLinks" ng-class="{disabled: currentPage === numPages}">\n    <a href="" ng-click="selectPage(currentPage + 1)">&rsaquo;</a>\n  </li>\n  <li ng-if="::boundaryLinks" ng-class="{disabled: currentPage === numPages}">\n    <a href="" ng-click="selectPage(numPages)">&raquo;</a>\n  </li>\n</ul>\n')}])});